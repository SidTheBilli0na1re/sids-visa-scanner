<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sid's VisaFlow</title>
  <script src="https://unpkg.com/tesseract.js@4.1.1/dist/tesseract.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg: #fafafa;
      --card-bg: #ffffff;
      --text: #0a0a0a;
      --text-muted: #737373;
      --border: #e5e5e5;
      --border-hover: #d0d0d0;
      --accent: #0a0a0a;
      --radius: 10px;
      --shadow-sm: 0 1px 3px rgba(0,0,0,0.06);
      --shadow-md: 0 4px 12px rgba(0,0,0,0.1);
    }

    * { box-sizing: border-box; margin: 0; padding: 0 }
    
    html, body { height: 100%; }
    
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    .topbar {
      background: #fff;
      border-bottom: 1px solid var(--border);
      padding: 16px 32px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: sticky;
      top: 0;
      z-index: 100;
      backdrop-filter: blur(8px);
      background: rgba(255,255,255,0.95);
    }

    .brand { 
      font-weight: 700; 
      font-size: 18px; 
      letter-spacing: -0.02em;
    }
    
    .back-link { 
      color: var(--text-muted); 
      text-decoration: none; 
      font-size: 14px;
      font-weight: 500;
      transition: color 200ms;
    }
    
    .back-link:hover { color: var(--text) }

    .wrap { 
      max-width: 1100px; 
      margin: 0 auto; 
      padding: 0 32px; 
    }

    .hero { 
      text-align: center; 
      padding: 48px 0 32px; 
    }
    
    .hero h2 { 
      font-size: 28px; 
      font-weight: 700; 
      margin: 0 0 32px; 
      letter-spacing: -0.03em;
      color: var(--text);
    }

    .cards { 
      display: flex; 
      gap: 20px; 
      justify-content: center; 
      align-items: stretch; 
    }
    
    .card { 
      flex: 1;
      max-width: 380px;
      background: var(--card-bg); 
      border: 1px solid var(--border); 
      border-radius: var(--radius); 
      padding: 28px; 
      text-align: left; 
      box-shadow: var(--shadow-sm); 
      cursor: pointer; 
      transition: all 200ms cubic-bezier(0.2, 0.8, 0.2, 1);
    }
    
    .card:hover { 
      border-color: var(--border-hover); 
      box-shadow: var(--shadow-md); 
      transform: translateY(-2px);
    }
    
    .card h3 { 
      margin: 0 0 8px; 
      font-size: 17px; 
      font-weight: 600;
      letter-spacing: -0.01em;
    }
    
    .card p { 
      margin: 0; 
      color: var(--text-muted); 
      font-size: 14px;
      line-height: 1.5;
    }

    .panel {
      opacity: 0;
      transform: translateY(10px);
      transition: opacity 200ms ease, transform 200ms ease;
      pointer-events: none;
      padding: 0;
    }
    
    .panel.active {
      opacity: 1;
      transform: translateY(0);
      pointer-events: auto;
    }

    .panel-header { 
      display: flex; 
      justify-content: space-between; 
      align-items: center; 
      padding: 0 0 16px; 
      border-bottom: 1px solid var(--border); 
      margin-bottom: 24px;
      margin-top: 32px;
    }
    
    .panel-header > div:first-child {
      font-weight: 600;
      font-size: 16px;
    }
    
    .panel-header span {
      color: var(--text-muted);
      font-weight: 400;
    }

    .form-group {
      margin-bottom: 20px;
      max-width: 760px;
    }
    
    .form-label {
      display: block;
      margin-bottom: 8px;
      color: var(--text-muted);
      font-size: 14px;
      font-weight: 500;
    }
    
    select, input[type="text"] {
      width: 100%;
      padding: 12px 16px;
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 15px;
      font-family: inherit;
      transition: all 200ms;
      background: #fff;
    }
    
    select:hover, input[type="text"]:hover {
      border-color: var(--border-hover);
    }
    
    select:focus, input[type="text"]:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(0,0,0,0.05);
    }

    .requirements-list {
      margin: 16px 0 24px;
      color: var(--text-muted);
      font-size: 14px;
    }
    
    .req-item {
      padding: 10px 0;
      border-bottom: 1px solid #f5f5f5;
    }
    
    .req-item:last-child {
      border-bottom: none;
    }
    
    .req-item strong {
      color: var(--text);
      font-weight: 600;
    }
    
    .req-critical {
      color: #dc2626;
      font-size: 12px;
      margin-left: 6px;
    }
    
    .req-keywords {
      color: var(--text-muted);
      font-size: 13px;
      margin-top: 4px;
    }

    .upload-card { 
      border-radius: var(--radius); 
      border: 2px dashed var(--border); 
      padding: 48px; 
      text-align: center; 
      color: var(--text-muted); 
      max-width: 900px;
      background: #fff;
      cursor: pointer;
      transition: all 200ms ease;
    }
    
    .upload-card:hover { 
      border-color: var(--border-hover); 
      background: #fafafa;
    }
    
    .upload-card svg { 
      width: 40px; 
      height: 40px; 
      margin-bottom: 12px; 
      opacity: 0.6;
    }
    
    .upload-card h4 { 
      margin: 8px 0 4px; 
      font-size: 15px; 
      font-weight: 600;
      color: var(--text);
    }
    
    .upload-card small { 
      display: block; 
      color: var(--text-muted); 
      margin-top: 4px; 
      font-size: 13px;
    }

    .btn { 
      background: var(--accent); 
      color: #fff; 
      padding: 12px 24px; 
      border-radius: 8px; 
      border: none; 
      display: inline-flex; 
      gap: 8px; 
      align-items: center; 
      cursor: pointer; 
      font-size: 14px;
      font-weight: 500;
      transition: all 200ms ease;
      font-family: inherit;
    }
    
    .btn:hover {
      background: #1a1a1a;
      transform: translateY(-1px);
      box-shadow: var(--shadow-md);
    }
    
    .btn:active {
      transform: translateY(0);
    }
    
    .btn svg { 
      width: 16px; 
      height: 16px;
    }

    .track-row { 
      display: flex; 
      gap: 12px; 
      align-items: center;
    }
    
    .track-row input { 
      flex: 1;
    }

    .file-info {
      color: var(--text-muted);
      margin-top: 16px;
      font-size: 14px;
      line-height: 1.8;
    }

    .results-area {
      margin-top: 32px;
    }
    
    .status-badge {
      padding: 12px 16px;
      border-radius: 8px;
      margin-bottom: 20px;
      font-weight: 600;
      font-size: 14px;
    }
    
    .status-success {
      background: #f0fdf4;
      border: 1px solid #86efac;
      color: #166534;
    }
    
    .status-warning {
      background: #fffbeb;
      border: 1px solid #fde047;
      color: #854d0e;
    }
    
    .status-error {
      background: #fef2f2;
      border: 1px solid #fca5a5;
      color: #991b1b;
    }

    .results-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
      margin: 24px 0;
    }
    
    .results-col h4 {
      font-size: 15px;
      font-weight: 600;
      margin-bottom: 12px;
      color: var(--text);
    }
    
    .result-item {
      padding: 10px 0;
      border-bottom: 1px solid #f5f5f5;
      font-size: 14px;
    }
    
    .result-item:last-child {
      border-bottom: none;
    }
    
    .result-item strong {
      color: var(--text);
    }
    
    .result-item div {
      color: var(--text-muted);
      font-size: 13px;
      margin-top: 2px;
    }
    
    .missing-item {
      color: #dc2626;
    }

    .loading {
      color: var(--text-muted);
      margin-top: 24px;
      font-size: 14px;
    }

    .pressable { 
      position: relative; 
      overflow: hidden;
      touch-action: manipulation;
    }
    
    .pressed {
      transform: scale(0.98);
    }

    details {
      margin-top: 24px;
      background: #fff;
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 16px;
    }
    
    summary {
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      color: var(--text);
      user-select: none;
    }
    
    pre {
      margin-top: 12px;
      white-space: pre-wrap;
      max-height: 300px;
      overflow: auto;
      background: #f9f9f9;
      padding: 12px;
      border-radius: 6px;
      font-size: 12px;
      line-height: 1.5;
    }

    @media (max-width: 768px) {
      .wrap { padding: 0 20px; }
      .topbar { padding: 16px 20px; }
      .cards { flex-direction: column; align-items: center; }
      .card { max-width: 100%; width: 100%; }
      .hero h2 { font-size: 24px; }
      .upload-card { padding: 32px 20px; }
      .results-grid { grid-template-columns: 1fr; gap: 20px; }
    }
  </style>
</head>
<body>
  <div class="topbar">
    <div class="brand">Sid's VisaFlow</div>
    <a id="backToMenu" class="back-link" href="#" style="display:none">‚Üê Back to Menu</a>
  </div>

  <main class="wrap">
    <!-- Menu -->
    <section id="menu" class="panel active">
      <div class="hero">
        <h2>Choose a service</h2>
        <div class="cards">
          <div class="card pressable" id="card-scan" tabindex="0">
            <h3>Scan Documents</h3>
            <p>Upload and extract text from visa documents with OCR technology</p>
          </div>

          <div class="card pressable" id="card-track" tabindex="0">
            <h3>Track Application</h3>
            <p>Check your visa application status using your reference number</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Scanner -->
    <section id="scanner" class="panel">
      <div class="panel-header">
        <div>Scanner <span>History (0)</span></div>
      </div>

      <div class="form-group" style="margin-top:0">
        <label class="form-label" for="visaType">Visa Category</label>
        <select id="visaType">
          <option value="">Select Visa Type</option>
          <option value="B1/B2">B1/B2 - Business/Tourist</option>
          <option value="F1">F1 - Student Visa</option>
          <option value="H1B">H1B - Specialty Occupation</option>
        </select>
      </div>

      <div class="form-group">
        <label class="form-label" for="countryOrigin">Country of Origin</label>
        <select id="countryOrigin">
          <option value="general">General Requirements</option>
          <option value="india">India</option>
          <option value="china">China</option>
          <option value="mexico">Mexico</option>
        </select>
      </div>

      <div id="requirementsList" class="requirements-list">
        Select a visa type to see requirements
      </div>

      <button id="analyzeBtn" class="btn pressable" style="display:none">
        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <circle cx="11" cy="11" r="6" stroke="currentColor" stroke-width="1.6"/>
          <path d="M21 21l-4.35-4.35" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
        </svg>
        Analyze Documents
      </button>

      <div id="fileInfo" class="file-info"></div>

      <div style="margin-top: 28px">
        <div class="upload-card pressable" id="uploadArea" tabindex="0">
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 4v8" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
            <path d="M8 8l4-4 4 4" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
            <rect x="3" y="12" width="18" height="7" rx="1" stroke="currentColor" stroke-width="1.2"/>
          </svg>
          <h4>Upload document image</h4>
          <small>PNG, JPG, or PDF (max 10MB)</small>
          <input id="fileInput" type="file" accept="image/*,.pdf" style="display:none" multiple>
        </div>
      </div>

      <div id="resultsPlaceholder" style="color:var(--text-muted);margin-top:24px;font-size:14px">
        Upload documents and click analyze to see results
      </div>
      
      <div id="resultsContent" style="display:none" class="results-area"></div>
      
      <div id="loadingIndicator" class="loading" style="display:none">
        <div>Analyzing documents... <span id="currentStatus">Initializing</span></div>
      </div>
    </section>

    <!-- Track Application -->
    <section id="track" class="panel">
      <div class="panel-header">
        <div>Check Application Status</div>
      </div>

      <div class="form-group" style="margin-top:0">
        <label class="form-label">Application Reference Number</label>
        <div class="track-row">
          <input id="refInput" type="text" placeholder="e.g., VIS-2024-123456">
          <button class="btn pressable" id="checkBtn">
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <circle cx="11" cy="11" r="6" stroke="currentColor" stroke-width="1.6"/>
              <path d="M21 21l-4.35-4.35" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
            </svg>
            Check Status
          </button>
        </div>
      </div>
    </section>
  </main>

  <script>
    const visaRequirements = {
      "B1/B2": {
        documents: [
          { name: "DS-160 Confirmation Page", critical: true, keywords: ["ds-160","ds160","confirmation"] },
          { name: "Valid Passport", critical: true, keywords: ["passport"] },
          { name: "2x2 Color Photograph", critical: true, keywords: ["photo","2x2"] }
        ],
        countrySpecific: {
          india: ["Income Tax Returns (3 years)"]
        }
      },
      "F1": { 
        documents: [ 
          { name: "Form I-20", critical:true, keywords:["i-20","i20"] }, 
          { name: "DS-160", critical:true, keywords:["ds-160"] } 
        ] 
      },
      "H1B": { 
        documents: [ 
          { name: "Form I-129", critical:true, keywords:["i-129"] } 
        ] 
      }
    };

    document.addEventListener('DOMContentLoaded', function() {
      const visaTypeSelect = document.getElementById('visaType');
      const countryOriginSelect = document.getElementById('countryOrigin');
      const requirementsList = document.getElementById('requirementsList');
      const fileInfo = document.getElementById('fileInfo');
      const analyzeBtn = document.getElementById('analyzeBtn');
      const resultsContent = document.getElementById('resultsContent');
      const resultsPlaceholder = document.getElementById('resultsPlaceholder');
      const loadingIndicator = document.getElementById('loadingIndicator');
      const currentStatusSpan = document.getElementById('currentStatus');
      const uploadArea = document.getElementById('uploadArea');
      const fileInput = document.getElementById('fileInput');

      let currentFiles = [];
      let currentVisaType = '';
      let currentCountry = 'general';

      visaTypeSelect.addEventListener('change', updateRequirements);
      countryOriginSelect.addEventListener('change', updateRequirements);
      fileInput.addEventListener('change', handleFileSelect);
      analyzeBtn.addEventListener('click', analyzeDocuments);

      function updateRequirements(){
        currentVisaType = visaTypeSelect.value;
        currentCountry = countryOriginSelect.value;
        
        if(!currentVisaType){ 
          requirementsList.textContent = 'Select a visa type to see requirements'; 
          analyzeBtn.style.display='none'; 
          return;
        }
        
        const req = visaRequirements[currentVisaType];
        if(!req) { 
          requirementsList.textContent = 'No requirements available'; 
          return;
        }
        
        let html = '';
        req.documents.forEach(d=>{
          html += `<div class="req-item">
            <strong>${d.name}</strong>${d.critical?'<span class="req-critical">(Critical)</span>':''}
            <div class="req-keywords">${d.keywords.join(', ')}</div>
          </div>`;
        });
        
        if(req.countrySpecific && req.countrySpecific[currentCountry]){
          html += '<div class="req-item"><strong>Country-specific:</strong>';
          req.countrySpecific[currentCountry].forEach(c=> html += `<div class="req-keywords">‚Ä¢ ${c}</div>`);
          html += '</div>';
        }
        
        requirementsList.innerHTML = html;
        analyzeBtn.style.display = currentFiles.length ? 'inline-flex' : 'none';
      }

      function handleFileSelect(e){
        const files = Array.from(e.target.files || []);
        const valid = files.filter(f=> {
          const t = f.type;
          const ok = t.startsWith('image/') || t === 'application/pdf';
          const sizeOk = f.size <= 10 * 1024 * 1024;
          if(!ok) alert('Unsupported file: '+f.name);
          if(!sizeOk) alert('File too large: '+f.name+' (max 10MB)');
          return ok && sizeOk;
        });
        
        currentFiles = valid;
        
        if(valid.length){
          uploadArea.querySelector('h4').textContent = `${valid.length} File(s) Selected`;
          fileInfo.textContent = valid.map(f=>`${f.name} (${(f.size/1024/1024).toFixed(2)} MB)`).join('\n');
          if(currentVisaType) analyzeBtn.style.display='inline-flex';
        } else {
          uploadArea.querySelector('h4').textContent = 'Upload document image';
          fileInfo.textContent = '';
          analyzeBtn.style.display='none';
        }
      }

      async function analyzeDocuments(){
        if(!currentVisaType || currentFiles.length===0){ 
          alert('Select visa type and upload files'); 
          return;
        }
        
        resultsPlaceholder.style.display='none'; 
        resultsContent.style.display='none'; 
        loadingIndicator.style.display='block'; 
        currentStatusSpan.textContent='Initializing OCR';

        try{
          let allText = '';
          const worker = Tesseract.createWorker({ 
            logger: m => {
              if(m.status) currentStatusSpan.textContent = m.status + (m.progress ? ' '+Math.round(m.progress*100)+'%':'' );
            }
          });
          
          await worker.load(); 
          await worker.loadLanguage('eng'); 
          await worker.initialize('eng');
          
          for(const file of currentFiles){
            currentStatusSpan.textContent = 'Processing '+file.name;
            const { data: { text } } = await worker.recognize(file);
            allText += '\n\n' + text;
          }
          
          await worker.terminate();

          currentStatusSpan.textContent = 'Analyzing content';
          const analysis = performAnalysis(allText, currentVisaType, currentCountry);
          displayResults(analysis, allText);
        }catch(err){
          console.error(err); 
          resultsContent.innerHTML = `<div class="status-badge status-error">Error: ${err.message || err}</div>`; 
          resultsContent.style.display='block';
        }finally{ 
          loadingIndicator.style.display='none'; 
        }
      }

      function performAnalysis(text, visaType, country){
        const requirements = visaRequirements[visaType];
        const lower = text.toLowerCase();
        const results = { found:[], missing:[], criticalMissing:0, confidence:0, warnings:[] };
        
        requirements.documents.forEach(doc=>{
          let score = 0; 
          doc.keywords.forEach(k=>{ if(lower.includes(k)) score += 1 });
          
          if(score >= 1){ 
            results.found.push({...doc, confidence: Math.min(100, Math.round(score/doc.keywords.length*100))}); 
          } else { 
            results.missing.push(doc); 
            if(doc.critical) results.criticalMissing++; 
          }
        });
        
        if(requirements.countrySpecific && requirements.countrySpecific[country]){
          requirements.countrySpecific[country].forEach(cs=>{
            if(!lower.includes(cs.substring(0,6).toLowerCase())){ 
              results.missing.push({name:cs, critical:true, countrySpecific:true}); 
              results.criticalMissing++; 
            }
          });
        }
        
        const total = requirements.documents.length; 
        results.confidence = Math.round((results.found.length/total)*100);
        
        if(results.criticalMissing) results.warnings.push(`üö® ${results.criticalMissing} critical documents missing`);
        if(results.confidence < 80) results.warnings.push(`‚ö†Ô∏è Low document confidence (${results.confidence}%)`);
        
        return results;
      }

      function displayResults(analysis, extractedText){
        let html = '';
        
        if(analysis.criticalMissing>0) {
          html += `<div class="status-badge status-error">HIGH RISK: ${analysis.criticalMissing} critical documents missing</div>`;
        } else if(analysis.confidence >= 90) {
          html += `<div class="status-badge status-success">Ready for submission</div>`;
        } else {
          html += `<div class="status-badge status-warning">Needs review</div>`;
        }

        html += `<div style="margin-bottom:16px;font-size:14px"><strong>Document Confidence:</strong> ${analysis.confidence}%</div>`;
        
        if(analysis.warnings.length){ 
          html += `<div style="color:var(--text-muted);margin-bottom:16px;font-size:14px">${analysis.warnings.join('<br>')}</div>` 
        }

        html += '<div class="results-grid">';
        html += `<div class="results-col"><h4>Verified (${analysis.found.length})</h4>`;
        analysis.found.forEach(f=> html += `<div class="result-item"><strong>${f.name}</strong><div>Confidence: ${f.confidence}%</div></div>`);
        html += `</div><div class="results-col"><h4>Missing (${analysis.missing.length})</h4>`;
        analysis.missing.forEach(m=> html += `<div class="result-item missing-item"><strong>${m.name}</strong>${m.countrySpecific?'<div>Country-specific</div>':''}</div>`);
        html += '</div></div>';

        html += `<details><summary>View Extracted Text</summary><pre>${extractedText.substring(0,5000)}</pre></details>`;

        resultsContent.innerHTML = html; 
        resultsContent.style.display='block';
      }

      // View switching
      const menu = document.getElementById('menu');
      const scanner = document.getElementById('scanner');
      const track = document.getElementById('track');
      const cardScan = document.getElementById('card-scan');
      const cardTrack = document.getElementById('card-track');
      const backToMenu = document.getElementById('backToMenu');

      function showPanel(panel){
        const current = document.querySelector('.panel.active');
        if(current === panel) return;

        document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
        panel.classList.add('active');

        backToMenu.style.display = panel === menu ? 'none' : 'inline';

        setTimeout(()=>{
          const topbarHeight = document.querySelector('.topbar').offsetHeight || 0;
          const rect = panel.getBoundingClientRect();
          const targetY = window.pageYOffset + rect.top - topbarHeight - 20;
          window.scrollTo({ top: Math.max(0, targetY), behavior: 'smooth' });
        }, 50);
      }

      cardScan.addEventListener('click', () => showPanel(scanner));
      cardTrack.addEventListener('click', () => showPanel(track));
      backToMenu.addEventListener('click', (e)=>{ e.preventDefault(); showPanel(menu); });

      // Press feedback
      function attachPressFeedback(element){
        if(!element) return;
        
        element.addEventListener('mousedown', ()=> element.classList.add('pressed'));
        element.addEventListener('mouseup', ()=> element.classList.remove('pressed'));
        element.addEventListener('mouseleave', ()=> element.classList.remove('pressed'));
        
        element.addEventListener('keydown', (e)=>{
          if(e.key === ' ' || e.key === 'Enter'){
            e.preventDefault();
            element.classList.add('pressed');
          }
        });
        element.addEventListener('keyup', (e)=>{
          if(e.key === ' ' || e.key === 'Enter'){
            element.classList.remove('pressed');
            element.click();
          }
        });
      }

      document.querySelectorAll('.pressable').forEach(el => attachPressFeedback(el));

      // Upload interactions
      uploadArea.addEventListener('click', () => fileInput.click());

      // Track check
      document.getElementById('checkBtn').addEventListener('click', ()=>{
        const v = document.getElementById('refInput').value.trim();
        if(!v) return alert('Please enter a reference number');
        alert('Checking status for ' + v + '\n\n(This is a UI demo)');
      });

      showPanel(menu);
    });
  </script>
</body>
</html>